!function(){"use strict";const e="http://www.w3.org/2000/svg",t=e=>e&&1===e.nodeType,n=(e,...t)=>{t.forEach(t=>{Object.keys(t).forEach(n=>{const r=String(t[n]);e.setAttribute(n,r)})})},r=(e,t=document)=>{const n=t.querySelector(e);if(null===n)throw Error(`Expected ${e} to match something`);return n},i=(e,t)=>{const n=e.elements.namedItem(t);if(n instanceof RadioNodeList)return n;throw Error("Expected a RadioNodeList called "+t)},o=e=>JSON.parse(JSON.stringify(e)),s=e=>{const{x:t,y:n,width:r,height:i}=e;return{x:t.baseVal.value,y:n.baseVal.value,width:r.baseVal.value,height:i.baseVal.value}},d=(e,t)=>{const n=s(e),{x:r,y:i,width:o,height:d}=Object.assign({},n,t);e.x.baseVal.value=r,e.y.baseVal.value=i,e.width.baseVal.value=o,e.height.baseVal.value=d},l=e=>(...t)=>((e,...t)=>{const r=document.createElement(e);return t.forEach(e=>{var t;(t=e)&&"number"==typeof t.nodeType||"string"==typeof e?r.append(e):n(r,e)}),r})(e,...t),a=l("div"),c=l("fieldset"),h=l("legend"),u=l("label"),f=l("input"),p=l("button"),g=l("form"),y=l("header"),m=l("footer"),v=l("main"),b=l("section"),x=l("p"),w=l("ol"),S=l("li"),C=(r,...i)=>{const o=document.createElementNS(e,r);return i.forEach(r=>{var i;t(i=r)&&i.namespaceURI===e||t(r)||"string"==typeof r?o.append(r):n(o,r)}),o},E=e=>(...t)=>C(e,...t),O=E("svg"),N=E("g"),k=E("rect"),I=E("defs"),_=E("pattern"),A=E("line"),T=({width:e,height:t},i=r("#gridPattern"))=>{const o=r("rect",i),[s,d]=i.querySelectorAll("line"),l={x:0,y:0,width:e,height:t},a={x1:0,y1:0,x2:0,y2:t},c={x1:0,y1:0,x2:e,y2:0};n(i,l),n(o,l),n(s,a),n(d,c)},j=(e,t=e)=>u(e+" ",f({id:t,readonly:"readonly"})),P=()=>{const e=r("#tools > form");return i(e,"fill").value},M=(e,t)=>{const n=r("#deltaName"),i=r("#dx"),o=r("#dy");n.value=t||"",i.value=(null==e?void 0:e.x)?Math.floor(e.x).toString():"",o.value=(null==e?void 0:e.y)?Math.floor(e.y).toString():""},D=(e,t)=>Math.floor(e/t)*t,L=({x:e,y:t},{x:n,y:r})=>({x:e+n,y:t+r}),z=({x:e,y:t},n)=>({x:e*n,y:t*n}),R=({x:e,y:t},{x:n,y:r})=>({x:e-n,y:t-r}),B=(e,t)=>!(t.x<e.x)&&(!(t.y<e.y)&&(!(t.x>e.x+e.width)&&!(t.y>e.y+e.height))),F=e=>{if(0===e.length)return;const[t,...n]=e;let{x:r,y:i}=t,o=r+t.width,s=i+t.height;n.forEach(e=>{const{x:t,y:n,width:d,height:l}=e,a=t+d,c=n+l;t<r&&(r=t),n<i&&(i=n),a>o&&(o=a),c>s&&(s=c)});return{x:r,y:i,width:o-r,height:s-i}},V=({x:e,y:t,width:n,height:r})=>({x:String(e),y:String(t),width:String(n),height:String(r)}),G=({x:e,y:t,width:n,height:r})=>({x:Number(e),y:Number(t),width:Number(n),height:Number(r)}),q=(e,...t)=>{let{x:n,y:r,width:i,height:o}=e;return 0===t.length?{x:n,y:r,width:i,height:o}:1===t.length?(n-=t[0],r-=t[0],i+=2*t[0],o+=2*t[0],{x:n,y:r,width:i,height:o}):2===t.length?(n-=t[1],r-=t[0],i+=2*t[1],o+=2*t[0],{x:n,y:r,width:i,height:o}):3===t.length?(n-=t[1],r-=t[0],i+=2*t[1],o+=t[0]+t[2],{x:n,y:r,width:i,height:o}):(n-=t[3],r-=t[0],i+=t[3]+t[1],o+=t[0]+t[2],{x:n,y:r,width:i,height:o})},U=({x:e,y:t,width:n,height:r})=>({top:t,right:e+n,bottom:t+r,left:e}),X=(e,t)=>{const n=L(e,t);return Object.assign({},e,n)},Y=(e,t,n)=>{e=o(e);const r={x:n.width/t.width,y:n.height/t.height},i=z(t,-1),s=R(n,t);return Object.assign(e,X(e,i)),Object.assign(e,(({x:e,y:t,width:n,height:r},{x:i,y:o})=>({x:e*=i,y:t*=o,width:n*=i,height:r*=o}))(e,r)),Object.assign(e,X(e,t)),Object.assign(e,X(e,s)),e},W=(e,t,n,r)=>{e=o(e);const i=z(t,-1);Object.assign(e,X(e,i));let{x:s,y:d,width:l,height:a}=e;return n&&(s=t.width-s-l),r&&(d=t.height-d-a),Object.assign(e,{x:s,y:d,width:l,height:a}),Object.assign(e,X(e,t)),e},$=e=>{const t=r("#selectionX"),n=r("#selectionY"),i=r("#selectionW"),o=r("#selectionH");if(void 0===e)return t.value="",n.value="",i.value="",void(o.value="");const{x:s,y:d,width:l,height:a}=V(e);t.value=s,n.value=d,i.value=l,o.value=a},J=["pan","draw","select"],H=["left","xCenter","right"],Z=["top","yCenter","bottom"],K=(e,t,n)=>{const r=q(e,t),i=q(e,-t);if(!B(r,n))return;const o=["xCenter","yCenter"];if(B(i,n))return o;const s=U(r),d=U(i);return n.y>=s.top&&n.y<=d.top&&(o[1]="top"),n.x>=d.right&&n.x<=s.right&&(o[0]="right"),n.y>=d.bottom&&n.y<=s.bottom&&(o[1]="bottom"),n.x>=s.left&&n.x<=d.left&&(o[0]="left"),o},Q=({x:e,y:t},{x:n,y:r,scale:i})=>(e-=n,t-=r,{x:e/=i,y:t/=i}),ee=(e,{scale:t,x:n,y:r},i)=>{t<i&&(t=i);const o=((e,t,n)=>{const{scale:r}=e;let i=L(e,z(n,-1));i=z(i,t/r),i=L(i,n);return Object.assign(i,{scale:t})})(e,t,{x:n,y:r});return Object.assign({},e,o)},te=(e,t)=>{const{clientX:n,clientY:r}=e;return{x:n-t.left,y:r-t.top}},ne=e=>t=>Q(t,e.viewTransform()),re=e=>t=>(({x:e,y:t},{width:n,height:r})=>({x:e=D(e,n),y:t=D(t,r)}))(Q(t,e.viewTransform()),e.snap()),ie=()=>[...r("#rects").querySelectorAll("rect")].filter(e=>""!==e.id||(console.warn("<rect> in rects has no ID",e),!1)),oe=()=>ie().map(e=>e.id),se=(e,t)=>{const{any:n,get:i}=e.selector.actions,o=r("#viewport"),d=r("#rects");return e=>{const l=o.getBoundingClientRect(),a=t(te(e,l));if(n()){if(i().map(e=>s(r("#"+e,d))).some(e=>B(e,a)))return"move"}return"select"}},de=e=>{const t=document.querySelector("#resizer");if(null===t)return;const n=t.dataset,r=G(n);return K(r,16,e)},le=(e,t)=>((e,t)=>e.map(e=>r("#"+e,t)))(e,t).map(e=>{const t=e.dataset.style||"none",{id:n}=e,r=s(e);return Object.assign({id:n,"data-style":t},r)}),ae=e=>{const{add:t,remove:n,toggle:r,any:i,get:o,set:s,clear:d}=e.selector.actions;return{addToSelection:t,removeFromSelection:n,toggleSelected:r,isAnySelected:i,getSelected:o,setSelected:s,clearSelection:d}},ce=e=>{const t=k({fill:"rgba( 255, 255, 255, 0.5 )",stroke:"rgba( 0, 0, 0, 0.5 )"});return he(e,t),t},he=(e,t=r("#"+e.id))=>{let{"data-style":i}=e;const o=ue(i);n(t,e,{fill:o}),t.dataset.style=i},ue=e=>e.startsWith("color")?e.replace("color ",""):"none",fe=(e,t=!1)=>{const r=f({type:"checkbox",name:"selectedLayers",value:e.id}),i=S(u({style:"background: "+ue(e["data-style"])},r));return t&&n(r,{checked:""}),i},pe=()=>String.fromCharCode(ge(26)+97),ge=e=>Math.floor(Math.random()*e),ye=(e,t)=>Array.from({length:e},(e,n)=>t(n)),me=(e,t)=>{const n=e.get(t);if(void 0===n)throw Error("Expected key "+t);return n},ve=ye(25,e=>Math.floor(14.4*e)+"deg").map(e=>`hsla(${e},100%,50%,0.75)`),be=(e,t=!1)=>{const r=f({type:"radio",name:"fill",value:"color "+e});t&&n(r,{checked:""});return u({class:"style-radio-label",style:"background: "+e},r)},xe=({x1:e,y1:t,x2:n,y2:r})=>({x:n-e,y:r-t}),we=({x:e,y:t},{x:n,y:r})=>({x1:e,y1:t,x2:n,y2:r}),Se=(e,t,n)=>{const{transformPoint:r,predicate:i,minDragDistance:o,minDragTime:s}=Object.assign({},Ce,n);let d,l,a;e.addEventListener("mousedown",t=>{const n=e.getBoundingClientRect();a=t.button,d=Date.now(),l=r(te(t,n))}),e.addEventListener("mouseup",n=>{const c=e.getBoundingClientRect();if(Date.now()-d>s)return;const h=r(te(n,c)),u=we(l,h);Math.abs((e=>{const{x:t,y:n}=xe(e);return Math.sqrt(t*t+n*n)})(u))>o||i(h,a,n)&&t(h,a,n)})},Ce={transformPoint:e=>e,predicate:()=>!0,minDragDistance:10,minDragTime:300},Ee=(e,t,n,i,o)=>{const s={transformPoint:ne(t)},d=Object.assign({},s,o,{predicate:i}),l=r("#viewport");Se(l,(t,i,o)=>{n(t,i,o),((e,t)=>{const n=r("#clickName"),i=r("#clickX"),o=r("#clickY");n.value=t||"",i.value=(null==e?void 0:e.x)?Math.floor(e.x).toString():"",o.value=(null==e?void 0:e.y)?Math.floor(e.y).toString():""})(t,e)},d)},Oe={onStart:()=>{},onEnd:()=>{},transformPoint:e=>e,predicate:()=>!0},Ne=(e,t,n,i)=>{const o=r("#viewport"),{onEnd:s}=i,d={transformPoint:ne(t)};((e,t,n)=>{const{onStart:r,onEnd:i,transformPoint:o,predicate:s}=Object.assign({},Oe,n);let d=null,l=null,a=null;e.addEventListener("mousedown",t=>{if(!s(t,"start"))return;const n=e.getBoundingClientRect();d=a=l=o(te(t,n)),r(d,a,l)}),e.addEventListener("mousemove",n=>{if(!s(n,"drag"))return;if(null===d||null===l||null===a)return;const r=e.getBoundingClientRect();l=a,a=o(te(n,r)),t(d,a,l)}),e.addEventListener("mouseup",e=>{s(e,"end")&&null!==d&&null!==l&&null!==a&&(i(d,a,l),d=null,a=null)})})(o,(t,r,i)=>{n(t,r,i),M(R(r,t),e)},Object.assign({},d,i,{onEnd:(e,t,n)=>{void 0!==s&&s(e,t,n),M()}}))},ke=(e,t,i,o,s,d)=>{const l=r("#rects");let a=null,c=null;Ne(e,t,(e,t)=>{null!==c&&(a=Ie(e,t),n(c,a))},{onStart:()=>{c=s(),a={x:0,y:0,width:0,height:0},l.after(c)},onEnd:()=>{null!==c&&null!==a&&(c.remove(),a.width>=1&&a.height>=1&&d(a),c=null,a=null)},transformPoint:o,predicate:i})},Ie=(e,t)=>{const n=(({x1:e,y1:t,x2:n,y2:r})=>{const i=Math.min(e,n),o=Math.max(e,n);return{x1:i,y1:Math.min(t,r),x2:o,y2:Math.max(t,r)}})(we(e,t)),{x1:r,y1:i}=n;return{x:r,y:i,width:n.x2-n.x1,height:n.y2-n.y1}},_e=e=>{const{clearSelection:t}=ae(e);let n=!1;const r=re(e);ke("draw",e,(r,i)=>"draw"===e.mode()&&(("start"!==i||0===r.button)&&("start"===i&&(n=!0),!!n&&(t(),!0))),r,()=>k({stroke:"#222",fill:"none"}),t=>{const n=ye(16,pe).join(""),r=Object.assign({id:n,"data-style":P()},t);e.rects.add([r])})},Ae=(e,t,n)=>{n.style.cursor="default";const r=document.querySelector("#resizer");if(null===r)return;const i=r.dataset,o=G(i),s=K(o,8,t);if(void 0===s)return;const d=(l=Te,Object.keys(l)).find(t=>Te[t](e,s));var l;void 0!==d&&(n.style.cursor=d)},Te={"ew-resize":(e,[t,n])=>"yCenter"===n&&("left"===t||"right"===t),"ns-resize":(e,[t,n])=>"xCenter"===t&&("top"===n||"bottom"===n),"nesw-resize":(e,[t,n])=>"right"===t&&"top"===n||"left"===t&&"bottom"===n,"nwse-resize":(e,[t,n])=>"right"===t&&"bottom"===n||"left"===t&&"top"===n,move:(e,[t,n])=>"select"===e.mode()&&("xCenter"===t&&"yCenter"===n)},je=e=>{const{getSelected:t,setSelected:i}=ae(e),o=r("#viewport");let s=null;const d=re(e);return Ne("resize",e,(e,o,d)=>{if(null===s)throw Error("Expected positions");const l=R(o,d),a=l.x,c=l.y;if(0===a&&0===c)return;const h=t(),u=le(h),f=F(u);void 0!==f&&(u.forEach(e=>{const t=r("#"+e.id);if(null===s)return;const i=((e,t,n,r,i=!1)=>{const o=(({top:e,right:t,bottom:n,left:r})=>({x:r,y:e,width:t-r,height:n-e}))(((e,t,n)=>{const[r,i]=n;let{top:o,right:s,bottom:d,left:l}=e;"top"===i&&(o+=t.y),"right"===r&&(s+=t.x),"bottom"===i&&(d+=t.y),"left"===r&&(l+=t.x);return{top:o,right:s,bottom:d,left:l}})(U(e),n,r));let s=!1,d=!1;if(o.width<0&&(s=!0,o.x+=2*o.width,o.width*=-1),o.height<0&&(d=!0,o.y+=2*o.height,o.height*=-1),0!==o.width&&0!==o.height)return t=Y(t,e,o),t=W(t,o,s,d)})(f,e,{x:a,y:c},s);void 0!==i&&n(t,i)}),i(h))},{onEnd:()=>{s=null;const n=t(),r=le(n);e.rects.update(r),i(n)},transformPoint:d,predicate:(t,n)=>{if("select"!==e.mode())return!1;if("start"===n){if(0!==t.button)return!1;const e=o.getBoundingClientRect(),n=d(te(t,e));if(s=de(n)||null,null!==s){const[e,t]=s;if("xCenter"===e&&"yCenter"===t)return!1}}return null!==s}})},Pe=e=>{const{toggleSelected:t,setSelected:n}=ae(e),i=r("#viewport"),o=r("#rects"),d=ne(e),l=se(e,d);ke("select",e,(t,n)=>{if("select"!==e.mode())return!1;if("start"===n){if(0!==t.button)return!1;if("move"===l(t))return!1;const e=i.getBoundingClientRect(),n=d(te(t,e));if(void 0!==de(n))return!1}return!0},d,()=>k({stroke:"#39f",fill:"none"}),r=>{const i=[...o.querySelectorAll("rect")],d=[];i.forEach(e=>{void 0!==((e,t)=>{const n=Math.max(e.x,t.x),r=Math.max(e.y,t.y),i=Math.min(e.x+e.width,t.x+t.width),o=Math.min(e.y+e.height,t.y+t.height);if(i>=n&&o>=r){return{x:n,y:r,width:i-n,height:o-r}}})(s(e),r)&&d.push(e.id)}),e.keys.shift?t(d):n(d)})},Me=()=>{const e=[];return Z.forEach(t=>{H.forEach(n=>{if("yCenter"===t&&"xCenter"===n)return;const r=De(n,t);e.push(r)})}),e},De=(e,t)=>k({class:["handle",e,t].join(" "),stroke:"rgba(64, 128, 255, 1)",fill:"rgba( 255, 255, 255, 0.75 )"}),Le=(e,t,n=r("#resizer"))=>{const i=r("#outline",n),o=(({x:e,y:t,width:n,height:r},i=1)=>({x:e+=i/2,y:t+=i/2,width:n-=i,height:r-=i}))(e);Object.assign(n.dataset,V(e)),d(i,o),ze(n,e,t)},ze=(e,t,n)=>{Z.forEach(i=>{const o=(({y:e,height:t},n)=>{switch(n){case"top":return e;case"bottom":return e+t;case"yCenter":return e+t/2}})(t,i);H.forEach(s=>{if("yCenter"===i&&"xCenter"===s)return;const d=(({x:e,width:t},n)=>{switch(n){case"left":return e;case"right":return e+t;case"xCenter":return e+t/2}})(t,s),l=r(`.handle.${s}.${i}`,e);Re(l,{x:d,y:o},s,i,n)})})},Re=(e,{x:t,y:n},r,i,o)=>{const s=o,l=o;switch(t-=s/2,n-=l/2,r){case"left":t+=1;case"right":t-=.5}switch(i){case"top":n+=1;case"bottom":n-=.5}d(e,{x:t,y:n,width:s,height:l})},Be=e=>{const t=r("#body"),n=r("#rects");e.selector.on(i=>{e.dirty=!0;const o=document.querySelector("#resizer");if(0===i.length)return null==o||o.remove(),void $();const d=i.map(e=>r("#"+e,n)).map(s),l=F(d);if($(l),void 0!==l)if(o)Le(l,8,o);else{const e=((e,t)=>{const n=k({id:"outline",stroke:"rgba(64, 128, 255, 1)",fill:"none"}),r=N({id:"resizer"},n,...Me());return Le(e,t,r),r})(l,8);t.append(e)}else null==o||o.remove()})},Fe=e=>{r("#reset-zoom").addEventListener("click",t=>{t.preventDefault(),e.zoomToFit()})},Ve=e=>{r("#undo").addEventListener("click",t=>{t.preventDefault(),e.rects.undo()})},Ge=e=>{r("#redo").addEventListener("click",t=>{t.preventDefault(),e.rects.redo()})},qe=e=>{const t=r("#viewport");t.addEventListener("wheel",n=>{n.preventDefault();const{left:r,top:i}=t.getBoundingClientRect(),{deltaY:o,clientX:s,clientY:d}=n,{scale:l}=e.viewTransform(),a=s-r,c=d-i,h=l+-.1*o;e.zoomAt({x:a,y:c,scale:h})})};function Ue(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var Xe=Ue((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=e=>Array.isArray(e),r=e=>null===e,i=e=>"object"==typeof e&&!r(e)&&!n(e);t.is={number:e=>"number"==typeof e&&isFinite(e),integer:e=>Number.isInteger(e),string:e=>"string"==typeof e,boolean:e=>"boolean"==typeof e,array:n,null:r,undefined:e=>void 0===e,function:e=>"function"==typeof e,object:i,empty:e=>i(e)&&(e=>{for(const t in e)return!1;return!0})(e)}}));const Ye=e=>{const t=Object.keys(e),n=(t,n)=>e[n]&&e[n](t),r=e=>t.filter(t=>n(e,t));return{isType:n,isOnly:(e,t)=>n(e,t)&&1===r(e).length,some:(e,...t)=>t.some(t=>n(e,t)),every:(e,...t)=>t.every(t=>n(e,t)),of:e=>t.find(t=>n(e,t)),allOf:r,types:()=>t.slice()}},We=Ye(Xe.is);var $e={is:Xe.is,extendDefaults:e=>Object.assign({},e,Xe.is,e),utils:We,Utils:Ye},Je=Object.freeze({DISCONNECTED:1,PRECEDING:2,FOLLOWING:4,CONTAINS:8,CONTAINED_BY:16});const He=Symbol(),Ze=Symbol(),Ke=Symbol(),Qe=Symbol();class et{constructor(e,t,n,r){this[He]=e,this[Ze]=t,this[Ke]=n,this[Qe]=r}next(){const e=this[He],t=this[Qe],n=this[Ze];if(!this[Ke])return{done:!0,value:n};const r=this[Ke];return this[Ke]=1===t?e._node(r).previousSibling:2===t?e._node(r).nextSibling:3===t?e._node(r).parent:4===t?e.preceding(r,{root:n}):e.following(r,{root:n}),{done:!1,value:r}}}Object.defineProperty(et.prototype,Symbol.iterator,{value:function(){return this},writable:!1}),et.PREV=1,et.NEXT=2,et.PARENT=3,et.PRECEDING=4,et.FOLLOWING=5,Object.freeze(et),Object.freeze(et.prototype);var tt=et;function nt(){return!0}function rt(e,t){return e[e.length-1-t]}class it{constructor(e){this.symbol=Symbol(e||"SymbolTree data")}initialize(e){return this._node(e),e}_node(e){if(!e)return null;const t=e[this.symbol];return t||(e[this.symbol]=new class{constructor(){this.parent=null,this.previousSibling=null,this.nextSibling=null,this.firstChild=null,this.lastChild=null,this.childrenVersion=0,this.childIndexCachedUpTo=null,this.cachedIndex=-1,this.cachedIndexVersion=NaN}get isAttached(){return Boolean(this.parent||this.previousSibling||this.nextSibling)}get hasChildren(){return Boolean(this.firstChild)}childrenChanged(){this.childrenVersion=this.childrenVersion+1&4294967295,this.childIndexCachedUpTo=null}getCachedIndex(e){return this.cachedIndexVersion!==e.childrenVersion?(this.cachedIndexVersion=NaN,-1):this.cachedIndex}setCachedIndex(e,t){this.cachedIndexVersion=e.childrenVersion,this.cachedIndex=t}})}hasChildren(e){return this._node(e).hasChildren}firstChild(e){return this._node(e).firstChild}lastChild(e){return this._node(e).lastChild}previousSibling(e){return this._node(e).previousSibling}nextSibling(e){return this._node(e).nextSibling}parent(e){return this._node(e).parent}lastInclusiveDescendant(e){let t,n=e;for(;t=this._node(n).lastChild;)n=t;return n}preceding(e,t){if(e===(t&&t.root))return null;const n=this._node(e).previousSibling;return n?this.lastInclusiveDescendant(n):this._node(e).parent}following(e,t){const n=t&&t.root,r=!(t&&t.skipChildren)&&this._node(e).firstChild;if(r)return r;let i=e;do{if(i===n)return null;const e=this._node(i).nextSibling;if(e)return e;i=this._node(i).parent}while(i);return null}childrenToArray(e,t){const n=t&&t.array||[],r=t&&t.filter||nt,i=t&&t.thisArg||void 0,o=this._node(e);let s=o.firstChild,d=0;for(;s;){const e=this._node(s);e.setCachedIndex(o,d),r.call(i,s)&&n.push(s),s=e.nextSibling,++d}return n}ancestorsToArray(e,t){const n=t&&t.array||[],r=t&&t.filter||nt,i=t&&t.thisArg||void 0;let o=e;for(;o;)r.call(i,o)&&n.push(o),o=this._node(o).parent;return n}treeToArray(e,t){const n=t&&t.array||[],r=t&&t.filter||nt,i=t&&t.thisArg||void 0;let o=e;for(;o;)r.call(i,o)&&n.push(o),o=this.following(o,{root:e});return n}childrenIterator(e,t){const n=t&&t.reverse,r=this._node(e);return new tt(this,e,n?r.lastChild:r.firstChild,n?tt.PREV:tt.NEXT)}previousSiblingsIterator(e){return new tt(this,e,this._node(e).previousSibling,tt.PREV)}nextSiblingsIterator(e){return new tt(this,e,this._node(e).nextSibling,tt.NEXT)}ancestorsIterator(e){return new tt(this,e,e,tt.PARENT)}treeIterator(e,t){const n=t&&t.reverse;return new tt(this,e,n?this.lastInclusiveDescendant(e):e,n?tt.PRECEDING:tt.FOLLOWING)}index(e){const t=this._node(e),n=this._node(t.parent);if(!n)return-1;let r=t.getCachedIndex(n);if(r>=0)return r;r=0;let i=n.firstChild;if(n.childIndexCachedUpTo){const e=this._node(n.childIndexCachedUpTo);i=e.nextSibling,r=e.getCachedIndex(n)+1}for(;i;){const t=this._node(i);if(t.setCachedIndex(n,r),i===e)break;++r,i=t.nextSibling}return n.childIndexCachedUpTo=e,r}childrenCount(e){const t=this._node(e);return t.lastChild?this.index(t.lastChild)+1:0}compareTreePosition(e,t){if(e===t)return 0;const n=[];{let r=e;for(;r;){if(r===t)return Je.CONTAINS|Je.PRECEDING;n.push(r),r=this.parent(r)}}const r=[];{let n=t;for(;n;){if(n===e)return Je.CONTAINED_BY|Je.FOLLOWING;r.push(n),n=this.parent(n)}}const i=rt(n,0);if(!i||i!==rt(r,0))return Je.DISCONNECTED;let o=0;const s=Math.min(n.length,r.length);for(let e=0;e<s;++e){if(rt(n,e)!==rt(r,e))break;o=e}const d=this.index(rt(n,o+1));return this.index(rt(r,o+1))<d?Je.PRECEDING:Je.FOLLOWING}remove(e){const t=this._node(e),n=this._node(t.parent),r=this._node(t.previousSibling),i=this._node(t.nextSibling);return n&&(n.firstChild===e&&(n.firstChild=t.nextSibling),n.lastChild===e&&(n.lastChild=t.previousSibling)),r&&(r.nextSibling=t.nextSibling),i&&(i.previousSibling=t.previousSibling),t.parent=null,t.previousSibling=null,t.nextSibling=null,t.cachedIndex=-1,t.cachedIndexVersion=NaN,n&&n.childrenChanged(),e}insertBefore(e,t){const n=this._node(e),r=this._node(n.previousSibling),i=this._node(t),o=this._node(n.parent);if(i.isAttached)throw Error("Given object is already present in this SymbolTree, remove it first");return i.parent=n.parent,i.previousSibling=n.previousSibling,i.nextSibling=e,n.previousSibling=t,r&&(r.nextSibling=t),o&&o.firstChild===e&&(o.firstChild=t),o&&o.childrenChanged(),t}insertAfter(e,t){const n=this._node(e),r=this._node(n.nextSibling),i=this._node(t),o=this._node(n.parent);if(i.isAttached)throw Error("Given object is already present in this SymbolTree, remove it first");return i.parent=n.parent,i.previousSibling=e,i.nextSibling=n.nextSibling,n.nextSibling=t,r&&(r.previousSibling=t),o&&o.lastChild===e&&(o.lastChild=t),o&&o.childrenChanged(),t}prependChild(e,t){const n=this._node(e),r=this._node(t);if(r.isAttached)throw Error("Given object is already present in this SymbolTree, remove it first");return n.hasChildren?this.insertBefore(n.firstChild,t):(r.parent=e,n.firstChild=t,n.lastChild=t,n.childrenChanged()),t}appendChild(e,t){const n=this._node(e),r=this._node(t);if(r.isAttached)throw Error("Given object is already present in this SymbolTree, remove it first");return n.hasChildren?this.insertAfter(n.lastChild,t):(r.parent=e,n.firstChild=t,n.lastChild=t,n.childrenChanged()),t}}var ot=it;it.TreePosition=Je;var st=Ue((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.valueSymbol=Symbol("Mojule node value"),t.apiSymbol=Symbol("Mojule node API");const n=new ot("Mojule node"),r=e=>e[t.apiSymbol];t.isTreeNode=e=>e&&e[t.valueSymbol],t.createNode=(e,i={})=>{const{extend:o}=i,s={value:e};n.initialize(s);const d=e=>{if(n.parent(e[t.valueSymbol])!==s)throw Error("Not a child of this node")},l={get value(){return s.value},set value(e){s.value=e},get firstChild(){return n.hasChildren(s)?n.firstChild(s)[t.apiSymbol]:null},get lastChild(){return n.hasChildren(s)?n.lastChild(s)[t.apiSymbol]:null},get previousSibling(){const e=n.previousSibling(s);return e?e[t.apiSymbol]:null},get nextSibling(){const e=n.nextSibling(s);return e?e[t.apiSymbol]:null},get parentNode(){const e=n.parent(s);return e?e[t.apiSymbol]:null},get childNodes(){return n.childrenToArray(s).map(r)},get ancestorNodes(){return n.ancestorsToArray(s).map(r)},get index(){return n.index(s)},hasChildNodes:()=>n.hasChildren(s),remove:()=>r(n.remove(s)),removeChild:e=>(d(e),r(n.remove(e[t.valueSymbol]))),insertBefore:(e,i)=>(d(i),n.remove(e[t.valueSymbol]),r(n.insertBefore(i[t.valueSymbol],e[t.valueSymbol]))),insertAfter:(e,i)=>(d(i),n.remove(e[t.valueSymbol]),r(n.insertAfter(i[t.valueSymbol],e[t.valueSymbol]))),prependChild:e=>(n.remove(e[t.valueSymbol]),r(n.prependChild(s,e[t.valueSymbol]))),appendChild:e=>(n.remove(e[t.valueSymbol]),r(n.appendChild(s,e[t.valueSymbol])))};return l[t.valueSymbol]=s,s[t.apiSymbol]=l,$e.is.function(o)&&o(l,s,n,t.valueSymbol,t.apiSymbol),l}}));const dt=(e,t)=>{const{nextIndex:n}=e;e.list=[...e.list.slice(0,n),t],e.nextIndex=e.list.length},lt=e=>{const{list:t}=e;if(0===t.length||0===e.nextIndex)return;const n=t[e.nextIndex-1];return e.nextIndex--,n},at=e=>{const{list:t,nextIndex:n}=e;if(0===t.length||n>=t.length)return;const r=t[e.nextIndex];return e.nextIndex++,r},ct=()=>{const e=[];let t=[];const n=t=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)};return{on:t=>(e.push(t),{dispose:()=>n(t)}),once:e=>{t.push(e)},off:n,emit:n=>{if(e.forEach(e=>e(n)),t.length>0){const e=t;t=[],e.forEach(e=>e(n))}}}},ht=(e,t)=>({addOne:n=>{((e,t)=>{if(e.has(t))throw Error("Duplicate key "+t)})(e,n.id);const r=st.createNode(n);return t.appendChild(r),e.set(n.id,r),n},removeOne:t=>{const n=me(e,t);return n.remove(),e.delete(t),n.value},updateOne:t=>{const n=me(e,t.id),r=n.value;return n.value=t,{prev:r,value:t}},setOrder:n=>{const r=t.childNodes.map(e=>e.value.id);if(n.length!==r.length)throw Error(`Expected ${r.length} ids`);return n.forEach(n=>{const r=me(e,n);t.appendChild(r)}),{type:"order",before:r,after:n}}}),ut=(e,t)=>t.sort((t,n)=>{const r=me(e,t),i=me(e,n);return r.index-i.index}),ft=()=>{const e=st.createNode({id:"root"}),t=new Map,n=(()=>{const e={list:[],nextIndex:0};return{add:t=>dt(e,t),nextUndo:()=>lt(e),nextRedo:()=>at(e)}})(),r={add:ct(),remove:ct(),update:ct(),setOrder:ct(),undo:ct(),redo:ct()},i={add:r.add.on,remove:r.remove.on,update:r.update.on,setOrder:r.setOrder.on,undo:r.undo.on,redo:r.redo.on},o=ht(t,e),s=((e,t)=>({toStart:n=>{ut(e,n).reverse().forEach(n=>{const r=me(e,n);t.prependChild(r)})},toEnd:n=>{ut(e,n).forEach(n=>{const r=me(e,n);t.appendChild(r)})},forward:n=>{ut(e,n).forEach(n=>{const r=me(e,n);r.nextSibling&&t.insertAfter(r,r.nextSibling)})},back:n=>{ut(e,n).reverse().forEach(n=>{const r=me(e,n);r.previousSibling&&t.insertBefore(r,r.previousSibling)})}}))(t,e);return{root:e,elMap:t,commands:n,events:r,on:i,tasks:o,orderActions:s,reorder:pt(r,n,e)}},pt=(e,t,n)=>r=>i=>{const o=n.childNodes.map(e=>e.value.id);r(i);const s=n.childNodes.map(e=>e.value.id);t.add({type:"order",before:o,after:s}),e.setOrder.emit(s)};var gt=Ue((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.fit=(e,t,n="fill")=>{if("scale-down"===n&&(n=t.width<=e.width&&t.height<=e.height?"none":"contain"),"cover"===n||"contain"===n){const r=e.width/t.width,i=e.height/t.height,o="cover"===n?Math.max(r,i):Math.min(r,i);return{width:t.width*o,height:t.height*o}}return"none"===n?t:e},t.position=(e,t,r="50%",i="50%")=>({x:n(r,e.width,t.width),y:n(i,e.height,t.height)}),t.fitAndPosition=(e,n,r="fill",i="50%",o="50%")=>{const s=t.fit(e,n,r),{x:d,y:l}=t.position(e,s,i,o),{width:a,height:c}=s;return{x:d,y:l,width:a,height:c}};const n=(e,t,n)=>e.endsWith("%")?(t-n)*(parseFloat(e)/100):parseFloat(e)})),yt=Ue((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.transformFittedPoint=(e,t,n,r="fill",i="50%",o="50%")=>{const{x:s,y:d,width:l,height:a}=gt.fitAndPosition(t,n,r,i,o),c=n.width/l,h=n.height/a;return{x:(e.x-s)*c,y:(e.y-d)*h}}})),mt=Ue((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n={contain:!0,cover:!0,fill:!0,none:!0,"scale-down":!0};t.isFit=e=>e in n})),vt=Ue((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.fit=gt.fit,t.position=gt.position,t.fitAndPosition=gt.fitAndPosition,t.transformFittedPoint=yt.transformFittedPoint,t.isFit=mt.isFit}));const bt=()=>{const e=new Set,t=ct(),n={add:n=>{n.forEach(t=>e.add(t)),t.emit([...e])},remove:n=>{n.forEach(t=>e.delete(t)),t.emit([...e])},toggle:n=>{n.forEach(t=>{e.has(t)?e.delete(t):e.add(t)}),t.emit([...e])},clear:()=>{e.clear(),t.emit([])},get:()=>{return t=[...e],JSON.parse(JSON.stringify(t));var t},set:t=>{e.clear(),n.add(t)},any:()=>e.size>0},{on:r}=t;return{actions:n,on:r}},xt=()=>{const e=r("#tools"),t=r("form",e),n=i(t,"mode");return e=>(void 0!==e&&(n.value=e),n.value)},wt=()=>{const e=r("#snap-width"),t=r("#snap-height");return n=>{if(void 0!==n){const{width:r,height:i}=n;e.valueAsNumber=r,t.valueAsNumber=i,T(n)}return{width:e.valueAsNumber,height:t.valueAsNumber}}},St=()=>{const e=r("#document");let t={width:0,height:0};return r=>{if(void 0!==r){t=r;const{width:i,height:o}=t;n(e,{viewBox:`0 0 ${i} ${o}`})}const{width:i,height:o}=t;return{width:i,height:o}}},Ct=()=>{const e=r("#grid");let t={width:0,height:0};return r=>{if(void 0!==r){t=r;const{width:i,height:o}=t;n(e,{x:0,y:0,width:i,height:o})}const{width:i,height:o}=t;return{width:i,height:o}}},Et=()=>{let e={x:0,y:0,scale:1};return t=>{if(void 0!==t){e=t;const{x:i,y:o,scale:s}=e,d=Math.max(s,.9),l=r("#body");n(l,{transform:`translate(${i} ${o}) scale(${d})`})}const{x:i,y:o,scale:s}=e;return{x:i,y:o,scale:s}}},Ot=(e,t,n)=>()=>n(((e,t)=>{const{x:n,y:r,width:i}=vt.fitAndPosition(e,t,"contain","50%","50%"),o=i/t.width;return{x:n/o,y:r/o,scale:o}})(e(),t())),Nt=e=>t=>e(ee(e(),t,.9)),kt=a({id:"app"},y("Rect Editor"),v(b({id:"tools"}),b({id:"viewport"}),b({id:"layers"})),m(x("Â© 2020 Nik Coughlin"))),It=g(a({id:"actionButtons"},p({id:"undo",type:"button"},"Undo"),p({id:"redo",type:"button"},"Redo"),p({id:"reset-zoom",type:"button"},"Reset Zoom")),c({id:"pointerMode"},h("Pointer Mode"),...J.map(e=>u(f({type:"radio",name:"mode",value:e}),e))),c({id:"snapToGrid"},h("Snap to Grid"),u("Width",f({id:"snap-width",type:"number",min:1,step:1})),u("Height",f({id:"snap-height",type:"number",min:1,step:1}))),c({id:"styles"},h("Styles"),be("rgba(255,255,255,0.75)",!0),be("rgba(191,191,191,0.75)"),be("rgba(127,127,127,0.75)"),be("rgba(63,63,63,0.75)"),be("rgba(0,0,0,0.75)"),...ve.map(e=>be(e)))),_t=O({id:"document"},I(_({id:"gridPattern",patternUnits:"userSpaceOnUse"},k({fill:"#ddd"}),A({stroke:"#39f"}),A({stroke:"#39f"}))),N({id:"body"},k({id:"grid",fill:"url(#gridPattern)"}),N({id:"rects"}))),At=a({id:"info"},c({id:"position"},h("Cursor Position"),j("x","positionX"),j("y","positionY")),c({id:"click"},h("Last Click"),j("name","clickName"),j("x","clickX"),j("y","clickY")),c({id:"delta"},h("Delta"),j("name","deltaName"),j("dx"),j("dy")),c({id:"selection"},h("Selection"),j("x","selectionX"),j("y","selectionY"),j("w","selectionW"),j("h","selectionH"))),Tt=c(h("Layers"),p({id:"toFront",type:"button",disabled:""},"To Front"),p({id:"forward",type:"button",disabled:""},"Forward"),p({id:"backward",type:"button",disabled:""},"Backward"),p({id:"toBack",type:"button",disabled:""},"To Back"),w(S(u()))),jt=r("#tools",kt),Pt=r("#viewport",kt),Mt=r("#layers",kt),Dt=r("footer",kt);jt.append(It),Pt.append(_t),Mt.append(Tt),Dt.append(At),document.body.append(kt);const Lt=(()=>{const e=xt(),t=wt(),n=St(),r=Et(),i=Ct();return{mode:e,snap:t,viewSize:n,viewTransform:r,documentSize:i,rects:(()=>{const{root:e,elMap:t,commands:n,events:r,on:i,tasks:o,orderActions:s,reorder:d}=ft();return{add:e=>{e.forEach(o.addOne),n.add({type:"add",elements:e}),r.add.emit(e)},remove:t=>{const i=e.childNodes.map(e=>e.value.id),s=t.map(o.removeOne);n.add({type:"remove",before:i,elements:s}),r.remove.emit(t)},update:e=>{const t=e.map(o.updateOne);n.add({type:"update",elements:t}),r.update.emit(e)},toStart:d(s.toStart),toEnd:d(s.toEnd),forward:d(s.forward),back:d(s.back),has:e=>t.has(e),get:e=>me(t,e).value,toArray:()=>e.childNodes.map(e=>e.value),undo:()=>{const e=n.nextUndo();return void 0!==e&&((({addOne:e,removeOne:t,updateOne:n,setOrder:r},i,o)=>{if("add"===o.type){const e=o.elements.map(e=>e.id);e.forEach(t),i.remove.emit(e)}if("remove"===o.type&&(o.elements.forEach(e),r(o.before),i.add.emit(o.elements),i.setOrder.emit(o.before)),"update"===o.type){const e=o.elements.map(e=>e.prev);e.forEach(n),i.update.emit(e)}"order"===o.type&&(r(o.before),i.setOrder.emit(o.before))})(o,r,e),r.undo.emit(),!0)},redo:()=>{const e=n.nextRedo();return void 0!==e&&((({addOne:e,removeOne:t,updateOne:n,setOrder:r},i,o)=>{if("add"===o.type&&(o.elements.forEach(e),i.add.emit(o.elements)),"remove"===o.type){const e=o.elements.map(e=>e.id);e.forEach(t),i.remove.emit(e)}if("update"===o.type){const e=o.elements.map(e=>e.value);e.forEach(n),i.update.emit(e)}"order"===o.type&&(r(o.after),i.setOrder.emit(o.after))})(o,r,e),r.redo.emit(),!0)},on:i}})(),selector:bt(),keys:{},dirty:!0,zoomToFit:Ot(n,i,r),zoomAt:Nt(r)}})();Lt.mode("draw"),Lt.snap({width:16,height:16}),Lt.documentSize({width:1e3,height:1e3}),(e=>{(e=>{const{get:t,clear:n,add:r}=e.selector.actions;document.addEventListener("keydown",i=>{e.keys[i.key]=!0;const o=i.key.toLowerCase();if(e.keys.Control&&"z"===o)return i.preventDefault(),void(e.keys.Shift?e.rects.redo():e.rects.undo());if(e.keys.Control&&"a"===o&&(i.preventDefault(),e.keys.Shift||r(oe())),"Delete"===i.key){i.preventDefault();const r=t();if(0===r.length)return;e.rects.remove(r),n()}}),document.addEventListener("keyup",t=>{e.keys[t.key]=!1})})(e),(e=>{const t=r("#viewport");document.body.addEventListener("resize",()=>{const{width:n,height:r}=t.getBoundingClientRect();e.viewSize({width:n,height:r})}),document.body.dispatchEvent(new Event("resize"))})(e),Fe(e),qe(e),(e=>{let t=!1;Ne("pan",e,(t,n)=>{const r=e.viewTransform(),i=xe(we(t,n));r.x+=i.x,r.y+=i.y,e.viewTransform(r)},{predicate:(n,r)=>"start"===r&&1===n.button?(t=!0,!0):("end"===r&&(t=!1),!!t||"pan"===e.mode()&&("start"!==r||0===n.button))})})(e),(e=>{const{clearSelection:t,toggleSelected:n,setSelected:r}=ae(e);Ee("select",e,i=>{const o=ie().filter(e=>{const t=e.getBBox();return B(t,i)});if(0===o.length)return void t();const s=o[o.length-1],{id:d}=s;e.keys.Shift?n([d]):r([d])},(t,n)=>"select"===e.mode()&&0===n)})(e),Pe(e),(e=>{const{get:t,set:i}=e.selector.actions,o=r("#viewport"),d=re(e),l=se(e,d);Ne("move",e,(e,o,d)=>{const l=o.x-d.x,a=o.y-d.y;if(0===l&&0===a)return;const c=t();c.map(e=>r("#"+e)).forEach(e=>{let{x:t,y:r}=s(e);t+=l,r+=a,n(e,{x:t,y:r})}),i(c)},{transformPoint:d,predicate:(t,n)=>{if("select"!==e.mode())return!1;if("start"===n){if(0!==t.button)return!1;if("move"!==l(t))return!1;const e=o.getBoundingClientRect(),n=d(te(t,e)),r=de(n);if(void 0===r)return!0;const[i,s]=r;return"xCenter"===i&&"yCenter"===s}return!0},onEnd:()=>{const n=t(),r=le(n);e.rects.update(r),i(n)}})})(e),(e=>{Ee("draw",e,(e,t)=>{},(t,n)=>"draw"===e.mode()&&0===n)})(e),_e(e),Ve(e),Ge(e),((e,t=ne(e))=>{const n=r("#viewport"),i=r("#positionX"),o=r("#positionY");n.addEventListener("mousemove",r=>{const s=n.getBoundingClientRect(),d=t(te(r,s));i.value=String(Math.floor(d.x)).padStart(6),o.value=String(Math.floor(d.y)).padStart(6),"select"===e.mode()&&Ae(e,d,n)})})(e),je(e),(()=>{const e=r("#snap-width"),t=r("#snap-width"),n=()=>{const n=e.valueAsNumber,r=t.valueAsNumber;T({width:n,height:r})};e.addEventListener("change",n),t.addEventListener("change",n)})(),(e=>{const t=r("#tools > form"),n=i(t,"fill"),o=()=>{const t=e.selector.actions.get();if(0===t.length)return;const n=le(t);n.forEach(e=>Object.assign(e,{"data-style":P()})),e.rects.update(n)};n.forEach(e=>e.addEventListener("change",o))})(e),(e=>{const{get:t,set:n}=e.selector.actions,i=r("#layers fieldset"),o=r("#toFront",i),s=r("#forward",i),d=r("#backward",i),l=r("#toBack",i);i.addEventListener("change",()=>{e.mode("select");const t=[...i.querySelectorAll('input[name="selectedLayers"]')].filter(e=>e.checked).map(e=>e.value);console.log("layer fieldset changed"),n(t)});const a=(e,n)=>{e.addEventListener("click",e=>{e.preventDefault();const r=t();n(r)})};a(o,e.rects.toEnd),a(s,e.rects.forward),a(d,e.rects.back),a(l,e.rects.toStart)})(e),(e=>{const{rects:t}=e,{clearSelection:n}=ae(e),i=r("#rects");t.on.add(t=>{i.append(...t.map(ce)),e.dirty=!0}),t.on.remove(t=>{t.forEach(e=>{r("#"+e).remove()}),e.dirty=!0}),t.on.update(t=>{t.forEach(e=>he(e)),e.dirty=!0}),t.on.setOrder(t=>{t.forEach(e=>{const t=r("#"+e);i.append(t)}),e.dirty=!0}),t.on.undo(n),t.on.redo(n)})(e),Be(e)})(Lt);let zt=JSON.stringify(Pt.getBoundingClientRect());const Rt=()=>{const e=JSON.stringify(Pt.getBoundingClientRect());e!==zt&&(document.body.dispatchEvent(new Event("resize")),zt=e,Lt.dirty=!0),Lt.dirty&&((e=>{const{getSelected:t,isAnySelected:n}=ae(e),i=r("#layers fieldset"),o=r("ol",i);o.innerHTML="";const s=oe(),d=t(),l=le(s).reverse();0===l.length&&o.append(S(u())),o.append(...l.map(e=>{const t=d.includes(e.id);return fe(e,t)}));const a=[...i.querySelectorAll("button")],c="select"===e.mode()&&n();a.forEach(e=>e.disabled=!c)})(Lt),Lt.dirty=!1),requestAnimationFrame(Rt)};Lt.zoomToFit(),Rt()}();
