let s=()=>{let e=e=>new Promise(t=>{let s=new Image;s.onload=(()=>t(s)),s.src=e}),t=e=>e[s(e.length)],s=(e,t=0)=>~~(Math.random()*e)+t,o=e=>e.slice().sort(()=>s(3)-1),n=(e,t)=>Math.max(e,t)-Math.min(e,t),r=([e,t])=>[[e-1,t],[e+1,t],[e,t-1],[e,t+1]],h=([e,t])=>[[e-1,t],[e+1,t],[e,t-1],[e,t+1],[e-1,t-1],[e+1,t-1],[e-1,t+1],[e+1,t+1]],a=(e,t,s)=>r(t).filter(t=>e[t[1]][t[0]]===s),l=([e,t],[s,o])=>Math.hypot(n(e,s),n(t,o)),u=(e,t)=>{let s,o=25600;for(let n=0;n<t.length;n++){let r=l(e,t[n]);r<o&&(o=r,s=t[n])}return s},g=([e,t],s)=>{let o=[],n=[[e,t,0]],h=[],a=([e,t,a])=>{S([e,t])&&s([e,t])&&(h[160*t+e]||(o.push([e,t,a]),h[160*t+e]=1,n.push(...r([e,t]).map(([e,t])=>[e,t,a+1]))))};for(;n.length;)a(n.shift());return o},p=([e,t],[s,o])=>{let r=n(e,s),h=n(t,o),a=e,l=t;return r>h&&(s>e&&(a=e+1),e>s&&(a=e-1)),h>r&&(o>t&&(l=t+1),t>o&&(l=t-1)),[a,l]},i=([e,s],[o,n],h=S,a=.66)=>{let l=[],c=[],u=([e,s])=>{c[160*s+e]||(l.push([e,s]),c[160*s+e]=1),e===o&&s===n||u(Math.random()<a?t(r([e,s]).filter(h))||[e,s]:p([e,s],[o,n]))};return u([e,s]),l},d=e=>[3===e?20:1===e?140:s(120,20),0===e?20:2===e?140:s(120,20)],f=()=>[s(120,20),s(120,20)],m=(e,[t,s])=>{for(let o=0;o<e.length;o++)if(e[o][0]===t&&e[o][1]===s)return!0;return!1},S=([e,t])=>e>=0&&e<=159&&t>=0&&t<=159,I=([e,t])=>e>=8&&e<=152&&t>=8&&t<=152,E=()=>{let e=[];for(let t=0;t<160;t++){let t=[];for(let e=0;e<160;e++)t.push(1);e.push(t)}return e},N=(e,t,s)=>{for(let o=0;o<t.length;o++){let[n,r]=t[o];e[r][n]=s([n,r])}},R=(e,n,c)=>{let p=E(),m=s(10,40),S=[d(0),d(1),d(2),d(3)];for(;S.length<m;){let e=f(),t=u(e,S);l(e,t)>10&&S.push(e)}let R=[],O=S.slice();let w=O.pop();let T=w;for(;O.length;){let e=u(w,O),t=i(w,e,I,.33);R.push(...t),w=O.pop()}let y=i(w,T,I,.33);R.push(...y);for(let e=0;e<10;e++){let e=i(t(S),t(S),I,.33);R.push(...e)}let C=[];for(let e=0;e<S.length;e++)C.push(...h(S[e]));let k=((e,s=8448)=>{let o=e.slice(),n=[];for(let e=0;e<o.length;e++){let[t,s]=o[e];n[160*s+t]=1}for(;o.length<s;){let[e,s]=t(o),h=r([e,s]);if(h.length){let[e,s]=t(h);n[160*s+e]||(o.push([e,s]),n[160*s+e]=1)}}return o})((e=>{let t=[],s=[];for(let o=0;o<e.length;o++){let[n,r]=e[o];s[160*r+n]||(t.push(e[o]),s[160*r+n]=1)}return t})([...S,...C,...R])),[A,F]=(e=>{let t=160,s=[0,0];for(let o=0;o<e.length;o++){let[n,r]=e[o];n<t&&(t=n,s=[n,r])}return s})(k);N(p,k,()=>2);let M=g([0,0],([e,t])=>1===p[t][e]);N(p,M,()=>0);let v=((e,t)=>t.slice().sort((t,s)=>l(e,t)-l(e,s)))([A,F],S),Y=i([A,F],v[0],I,.33);R.push(...Y),(e=>{let t=0;let n=o([0,3,6,9]);for(let o=0;o<160;o++)for(let r=0;r<160;r++)if(1===e[o][r]){let h=g([r,o],([t,s])=>1===e[s][t]);let a=0;h.length>5&&(a=t<4?n[t]:s(10),t++),N(e,h,a<3?()=>s(9)+2:a<6?()=>s(3)?s(4)+11:s(9)+2:a<9?()=>s(4)?s(3)+31:s(9)+2:()=>0)}})(p),(e=>{for(let t=0;t<160;t++)for(let o=0;o<160;o++)2===e[t][o]&&(a(e,[o,t],0).length?e[t][o]=s(3)+17:e[t][o]=s(13)+2)})(p),N(p,R,([e,t])=>p[t][e]>=17&&p[t][e]<20?p[t][e]:2),N(p,C,([e,t])=>p[t][e]>=17&&p[t][e]<20?p[t][e]:s(9)+2);let G=v.length-4,L=~~(.25*G),$=~~(.15*G),b=~~(.5*G),D=G-L-$-b,P=[];for(let e=0;e<L;e++)P.push(1);for(let e=0;e<$;e++)P.push(3);for(let e=0;e<b;e++)P.push(2);for(let e=0;e<D;e++)P.push(5);let H=[0,1,2,...o(P),4];for(let t=0;t<v.length;t++){let[o,r]=v[t],h=H[t];0===h?p[r][o]=38:1===h?(p[r][o]=20,e[160*r+o]=[0,0,0],e[0].push([o,r])):2===h?(p[r][o]=s(3)+28,n[160*r+o]=[],n[0].push([o,r])):3===h?(p[r][o]=36,c[0].push([o,r])):4===h&&(p[r][o]=34)}return[3,A,F,p,0,A,F]},O=e=>e<2||e>=11&&e<15||20===e||27===e||24===e||25===e||26===e||21===e||22===e||23===e||e>=28&&e<31||e>=31&&e<34||36===e||44===e||43===e||34===e,w=[];w[0]=[0,"s.png"],w[1]=[1,["Lost contact with","RANGER. Take boat","and investigate."]],w[2]=[1,["Sunrise"]],w[3]=[1,["Sunset"]],w[8]=[1,["I should","investigate"]],w[9]=[2,["Sleep?",""],[["Yes",11],["No",-1]],0,"g"],w[10]=[1,["I'm not tired!"]],w[11]=[4,0],w[12]=[1,["I'm hungry!"]],w[13]=[1,["You died","","GAME OVER!"]],w[14]=[1,["It's RANGER!","","RANGER is DEAD!","","Found 1 keycard","Found 5 food","Found 3 chips","Found 2 backups"]],w[15]=[1,["It's locked!"]],w[16]=[2,["It's locked!","","Use keycard?",""],[["Yes",17],["No",-1]],0,"g"],w[17]=[4,1],w[18]=[2,["Search ruins?","","1 hour",""],[["Yes",19],["No",-1]],0,"g"],w[19]=[4,2],w[21]=[4,3],w[23]=[4,4],w[26]=[4,5],w[27]=[4,6],w[28]=[4,7],w[29]=[4,8],w[30]=[4,9],w[31]=[4,10],w[33]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 1","","RANGER:","Sent to investigate","ruins. Found strange","technology"],[],0,"a"],w[34]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 2","","RANGER:","Was testing strange","technology. Portals","appeared!"],[],0,"a"],w[35]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 3","","RANGER:","Monsters coming out","of portals! Made it","back to hut. They","only come out at","night"],[],0,"a"],w[36]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 4","","RANGER:","Monsters affecting","computers. Have been","stashing items in","ruins for emergency.","Tried comms but the","satellite is offline"],[],0,"a"],w[37]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 5","","RANGER:","Programmed synth to","make mod chips that","can shut down portal","but computer went","offline! There are","more of them every","night"],[],0,"a"],w[38]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 6","","RANGER:","Got computer online.","Still has errors.","Comms are badly","damaged"],[],0,"a"],w[39]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 7","","RANGER:","Rigged comms to send","distress signal but","satellite offline.","Synth can make chip","to fix it"],[],0,"a"],w[40]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 8","","RANGER:","Must disable portals","before send distress","signal, no way to","warn rescue team","about monsters","with comms offline"],[],0,"a"],w[41]=[4,11],w[42]=[4,12],w[43]=[4,13],w[44]=[4,14],w[45]=[4,15];let T=e=>{let t=P[0]()[6],s=P[0]()[7];c.className=t,c.width=c.height=160,3===s[0]&&(F(e),M()),0===s[0]&&"s.png"===s[1]&&(Y.drawImage(b,0,0),Y.drawImage($,64,0,16,16,72,72,16,16),C("Js13kGames OFFLINE",1,16),C("C2018 Nik Coughlin",1,18)),1===s[0]&&k(s[1]),2===s[0]&&A(s),5===s[0]&&v(),requestAnimationFrame(T)},y=(e="",t=0,s=0)=>Y.drawImage(G,8*(e.charCodeAt(0)-32),0,8,8,8*t,8*s,8,8),C=(e="",t=0,s=0)=>{for(let o=0;o<e.length;o++)y(e[o],t+o,s)},k=e=>{let t=~~((20-e.length)/2);for(let s=0;s<e.length;s++){let o=~~((20-e[s].length)/2);C(e[s],o,t+s)}},A=e=>{for(let t=0;t<e[1].length;t++)C(e[1][t],0,t);C("<X>",17,0);let t=e[1].length%2?1:0;for(let s=0;s<e[2].length;s++)C(`${s+1} ${s===e[3]?"<":" "}${e[2][s][0]}${s===e[3]?">":" "}`,0,2*s+e[1].length+t)},F=e=>{let t=~~(e/500)%2?0:1,s=P[0]()[8],o=P[0]()[7],n=o[3],r=o[1],h=o[2],a=o[4],l=o[5],c=o[6],u=P[0]()[2],g=P[0]()[0],p=P[0]()[16],i=P[0]()[12],d=P[0]()[4]>=18||P[0]()[4]<6;for(let e=0;e<9;e++)for(let o=0;o<9;o++){let f=r-4+o,m=h-4+e;let I=16*t;if(S([f,m])){let e=n[m][f];e&&(I=16*e)}if(Y.drawImage(L,I,0,16,16,16*(o+1),16*(e+1),16,16),36===n[m][f]&&(d?Y.drawImage(L,16*(36+t),0,16,16,16*(o+1),16*(e+1),16,16):Y.drawImage(L,704,0,16,16,16*(o+1),16*(e+1),16,16)),34===n[m][f]&&p&&Y.drawImage(L,16*(34+t),0,16,16,16*(o+1),16*(e+1),16,16),0===a&&d)for(let n=0;n<s.length;n++){let r=s[n],h=r[0],a=r[1],l=r[2];h===f&&a===m&&r[3]>0&&(I=16*(7+t)+16*l*2,Y.drawImage($,I,0,16,16,16*(o+1),16*(e+1),16,16))}4===o&&4===e&&(I=u?16*t+16*g*2:64,Y.drawImage($,I,0,16,16,16*(o+1),16*(e+1),16,16)),0===a&&f===l-2&&m===c&&Y.drawImage($,80,0,16,16,16*(o+1),16*(e+1),16,16),0===a&&f===l-1&&m===c&&Y.drawImage($,96,0,16,16,16*(o+1),16*(e+1),16,16),0!==a||i[160*m+f]||Y.drawImage(L,672,0,16,16,16*(o+1),16*(e+1),16,16)}},M=()=>{let e=P[0]()[1],t=P[0]()[2],s=P[0]()[9],o=P[0]()[10],n=P[0]()[11],r=P[0]()[17],h=P[0]()[18];C(`RANGER DOWN ${P[2]()}`,2.5,.5),Y.drawImage(L,256,0,16,16,0,0,16,16),C(`${t}`,t<10?.5:0,2),Y.drawImage(L,240,0,16,16,0,24,16,16),C(`${e}`,e<10?.5:0,5),Y.drawImage(L,624,0,16,16,0,48,16,16),C(`${s}`,s<10?.5:0,8),Y.drawImage(L,640,0,16,16,0,72,16,16),C(`${n}`,n<10?.5:0,11),Y.drawImage(L,656,0,16,16,0,96,16,16),C(`${o}`,o<10?.5:0,14),r>-1&&C(`${r}`,r<10?.5:0,15),h>-1&&C(`${h}`,h<10?.5:0,16)};let v=()=>{let e=P[0]()[7],t=P[0]()[12],o=P[0]()[13],n=P[0]()[14],r=P[0]()[16],h=e[1],a=e[2],l=e[3],c=e[4];for(let e=0;e<160;e++)for(let o=0;o<160;o++){let n=~~(o/40),r=~~(e/40),h=l[e][o],a=h>=17&&h<20;c[4*r+n]?O(h)?Y.drawImage(L,432,0,1,1,o,e,1,1):t[160*e+o]||a?Y.drawImage(L,32,0,1,1,o,e,1,1):o%2&&!(e%2)||!(o%2)&&e%2?Y.drawImage(L,32,0,1,1,o,e,1,1):Y.drawImage(L,432,0,1,1,o,e,1,1):o>8&&e>8&&(s(2)?Y.drawImage(L,32,0,1,1,o,e,1,1):Y.drawImage(L,432,0,1,1,o,e,1,1))}for(let e=0;e<160;e++)for(let t=0;t<160;t++){let s=~~(t/40),h=~~(e/40),a=l[e][t];if(c[4*h+s]){if(20===a){o[160*e+t][0]?(Y.drawImage(L,32,0,9,9,t-4,e-4,9,9),Y.drawImage(D,35,0,7,7,t-3,e-3,7,7)):(Y.drawImage(L,432,0,9,9,t-4,e-4,9,9),Y.drawImage(D,0,0,7,7,t-3,e-3,7,7))}if(a>=28&&a<31){n[160*e+t].length?(Y.drawImage(L,32,0,9,9,t-4,e-4,9,9),Y.drawImage(D,7,0,7,7,t-3,e-3,7,7)):(Y.drawImage(L,432,0,9,9,t-4,e-4,9,9),Y.drawImage(D,42,0,7,7,t-3,e-3,7,7))}34===a&&(r?(Y.drawImage(L,32,0,9,9,t-4,e-4,9,9),Y.drawImage(D,49,0,7,7,t-3,e-3,7,7)):(Y.drawImage(L,432,0,9,9,t-4,e-4,9,9),Y.drawImage(D,14,0,7,7,t-3,e-3,7,7))),36===a&&(Y.drawImage(L,32,0,9,9,t-4,e-4,9,9),Y.drawImage(D,28,0,7,7,t-3,e-3,7,7)),43===a&&(Y.drawImage(L,32,0,9,9,t-4,e-4,9,9),Y.drawImage(D,56,0,7,7,t-3,e-3,7,7))}}Y.drawImage(L,32,0,9,9,h-4,a-4,9,9),Y.drawImage(D,21,0,7,7,h-3,a-3,7,7);for(let e=0;e<40;e++)Y.drawImage(G,8*(16+e),0,8,8,0,40*e+20,8,8);for(let e=0;e<40;e++)Y.drawImage(G,8*(33+e),0,8,8,40*e+20,0,8,8)},Y=c.getContext("2d");let G,L,$,b,D,P=(()=>{let e,n,r,a,c,u,i,d,f,I,T,y,C,k,A,F,M,v,Y,G,L,$,b,D;let P=()=>{e=[[]],n=[[]],D=[[]],r=0,a=5,c=20,u=20,i=0,d=0,f=0,I=17,T=55,w[7]=R(e,n,D),C=[w[7],w[1],w[0]],y="",k=[],M=0,$=-1,b=-1,G=[33],L=[],A=[],F=0;let t=w[7],s=t[1],o=t[2];L[4*~~(o/40)+~~(s/40)]=1,U(),K(),Z(t)},H=()=>{C.pop(),C.length||P()},B=([e,t])=>{let o=s(2),n=s(2)+1,r=w[7],h=r[3][t][e],a=r[1],l=r[2];O(h)||m(k,[e,t])||a===e&&l===t||k.push([e,t,o,n])},U=()=>{for(;k.length<8;){let e=s(160),t=s(160);B([e,t])}},x=([e,t])=>{for(let s=0;s<k.length;s++){let o=k[s],n=o[0],r=o[1];if(o[3]>0&&e===n&&t===r)return 1}},K=()=>{let s=e[0].length,r=s+2,h=~~(7*s),a=~~(2*s);let l=[];for(let e=0;e<r;e++)l.push(0);for(let e=0;e<h;e++)l.push(1);for(let e=0;e<50;e++)l.push(2);for(let e=0;e<a;e++)l.push(3);for(l=o(l);l.length;){let e=l.pop(),[s,o]=t(n[0]);n[160*o+s].push(e)}},W=(t=0)=>{if(c<1)C=[w[13]];else{if(60==++T&&(T=0,I++,t?(c<u&&c++,6===I&&(y="")):(6===I&&(y="",C.push(w[2])),18===I&&(y="i",C.push(w[3])),a>0?(a--,c<u&&c++):(c--,C.push(w[12])))),24===I){let t=e[0];for(let s=0;s<t.length;s++){let[o,n]=t[s];e[160*n+o][2]=0}I=0;let o=w[7];for(let e=0;e<160;e++)for(let t=0;t<160;t++)if(36===o[3][e][t]){let o=h([t,e]);for(let e=0;e<o.length;e++)s(3)||B(o[e])}}(()=>{for(let e=0;e<k.length;e++){let t=k[e],o=t[0],n=t[1],r=C[C.length-1],h=w[7],a=h[1],l=h[2],u=[o,n];if((I>=18||I<6)&&Math.random()<.66){let e=p([o,n],[a,l]);u[0]=e[0],u[1]=e[1]}else s(2)?u[0]=o+(s(3)-1):u[1]=n+(s(3)-1);let g=h[3][u[1]][u[0]];O(g)||x([u[0],u[1]])||a===u[0]&&l===u[1]||(t[0]=u[0],t[1]=u[1],u[0]<o&&(t[2]=1),u[0]>o&&(t[2]=0)),3===r[0]&&0===r[4]&&(I>=18||I<6)&&a===u[0]&&l===u[1]&&s(2)&&c>0&&t[3]>0&&c--}})()}},Z=e=>{if(0===e[4]){let t=e[1],s=e[2];for(let e=-4;e<4;e++)for(let o=-4;o<4;o++){let n=t+o,r=s+e;l([t,s],[n,r])<4&&(A[160*r+n]=1)}}},X=[()=>{for(;6!==I;)W(1)},()=>{v[0]=1,i--},()=>{let e=w[7],t=e[1],o=e[2],n=h([t,o]);let r=0;for(let e=0;e<60;e++){W();for(let t=0;t<n.length;t++){let[s,o]=n[t];(I>=18||I<6)&&x([s,o])&&(r=1,e=60)}}if(r)C.push([1,["Under attack!"]]);else{let e=Y.pop();if(3===e){let e=s(3)+2;C.push([1,[`Found ${e} food`]]),a+=e}else 0===e?(C.push([1,["Found keycard"]]),i++):1===e?(C.push([1,["Found chip"]]),d++):2===e&&(C.push([1,["Found backup"]]),f++)}},()=>{v[1]?C.push([2,["RSOS v3.27","--------------------",""],[["SYNTHESIZE",27],["DIAGNOSTICS",42],["NOTES",28],["COMMS",29],["MAP",31]],0,"a"]):C.push([2,["RSOS v3.27","--------------------","NETWORK OFFLINE","","EMERGENCY MODE",""],[["SYNTHESIZE",27],["DIAGNOSTICS",42]],0,"a"])},()=>{C.push([1,["Fixed 6 chips"]]),d-=6,v[1]=1},()=>{let e=s(3)+6;v[2]=1,a+=e,C.push([1,[`Synthesized ${e} food`]])},()=>{let e=[],t=[2,["RSOS v3.27","--------------------","SYNTHESIZER"],e,0,"a"];v[2]?t[1].push("  CHARGING..."):(e.push(["RATIONS",26]),$>-1&&e.push(["MOD CHIPS",43]),b>-1&&e.push(["SATELLITE CHIP",44])),C.push(t)},()=>{let e=[2,["RSOS v3.27","--------------------","NOTES"],G.map(e=>[`ENTRY ${e}`,e]),0,"a"];C.push(e)},()=>{let e=[],t=[2,["RSOS v3.27","--------------------","COMMS"],e,0,"a"];F?e.push(["DISTRESS SIGNAL",45]):t[1].push("  SATELLITE OFFLINE"),C.push(t)},()=>{},()=>{let e=w[7],t=[5,e[1],e[2],e[3],L];C.push(t)},()=>{f--;let e=G.length+33,o=s(8);if(G.length+33>37&&-1===$)C.push([1,["Recovered 1 synth","database entry"]]),$=0;else if(G.length+33>39&&-1===b)C.push([1,["Recovered 1 synth","database entry"]]),b=0;else if(o<3&&e<41)G.push(e),C.push(w[G.length+33-1]),C.push([1,["Recovered 1 note","database entry"]]);else{let s=[];for(let e=0;e<4;e++)for(let t=0;t<4;t++)L[4*e+t]||s.push([t,e]);if(s.length){let[e,o]=t(s);L[4*o+e]=1,X[10](),C.push([1,["Recovered 1 map","database entry"]])}else e<41?(G.push(e),C.push(w[G.length+33-1]),C.push([1,["Recovered 1 note","database entry"]])):C.push([1,["Backup already","restored"]])}},()=>{if(v[1]){let e=[];for(let t=0;t<4;t++)for(let s=0;s<4;s++)L[4*t+s]||e.push([s,t]);let t=["RSOS v3.27","--------------------","DIAGNOSTICS","","NETWORK ONLINE","SYNTHESIZE ONLINE"];-1===b&&t.push("  RESTORE BACKUPS"),t.push("NOTES ONLINE"),G.length<8&&t.push("  RESTORE BACKUPS"),F?(t.push("COMMS ONLINE"),t.push("  DISTRESS MODE ONLY")):t.push("COMMS OFFLINE"),t.push("MAP ONLINE"),e.length&&t.push("  RESTORE BACKUPS"),C.push([2,t,[],0,"a"])}else C.push([2,["RSOS v3.27","--------------------","DIAGNOSTICS","","NETWORK OFFLINE","  FIX 6 CHIPS","SYNTHESIZE ONLINE","  EMERGENCY MODE","NOTES OFFLINE","COMMS OFFLINE","MAP OFFLINE"],[],0,"a"])},()=>{let e=s(2)+2;v[2]=1,$+=e,C.push([1,[`Synthesized ${e}`,"mod chips"]])},()=>{v[2]=1,b++,C.push([1,["Synthesized","satellite chip"]])},()=>{let e=D[0],t=w[7][3];let s=0;for(let o=0;o<e.length;o++){let[n,r]=e[o];43!==t[r][n]&&(s=1)}C=s?[[1,["You send the","distress signal.","","As the rescue team","arrives monsters","pour out of","remaining portals","and kill them all!","","GAME OVER!"]]]:[[1,["You send the","distress signal.","","The rescue team","arrives and you","help them kill","the remaining","monsters.","","YOU WIN!"]]]}];return P(),[()=>[r,a,c,u,I,T,(()=>0===C[C.length-1][0]?"g":1===C[C.length-1][0]?"g":5===C[C.length-1][0]?"a":2===C[C.length-1][0]?C[C.length-1][4]:y)(),C[C.length-1],k,i,d,f,A,e,n,D,F,$,b],P,()=>`${I<10?"0":""}${I}:${T<10?"0":""}${T}`,W,(t,o)=>{let h=C[C.length-1];if(3!==h[0])return;let l;if(W(),-1===t&&(r=1),1===t&&(r=0),t=h[1]+t,o=h[2]+o,(I>=18||I<6)&&0===h[4])for(let e=0;e<k.length;e++)k[e][0]===t&&k[e][1]===o&&k[e][3]>0&&(l=k[e]);if(c>0&&S([t,o])&&!O(h[3][o][t])&&!l&&(h[1]=t,h[2]=o),Z(h),0===h[4]&&(20===h[3][o][t]&&((v=e[160*o+t])[0]?C.push((()=>{let e=E(),t=g([0,0],([t,s])=>1===e[s][t]);return N(e,t,()=>27),e[19][18]=21,e[19][19]=22,e[19][20]=23,e[20][18]=2,e[20][19]=2,e[20][20]=2,e[21][18]=24,e[21][19]=25,e[21][20]=26,[3,20,20,e,1,20,20]})()):i?C.push(w[16]):C.push(w[15])),o===h[6]&&t===h[5]-1&&C.push(w[8]),l&&s(2)&&l[3]--,38!==h[3][o][t]||M||(M=1,C.push(w[14]),i++,a+=5,d+=3,f+=2),h[3][o][t]>=28&&h[3][o][t]<31&&((Y=n[160*o+t]).length?C.push(w[18]):C.push([1,["Nothing here"]])),36===h[3][o][t]&&($>0?(C.push([1,["Portal disabled!"]]),h[3][o][t]=43,D[160*o+t]=1,$--):$>-1?C.push([1,["Need mod chips"]]):C.push([1,["A strange portal"]])),34===h[3][o][t]&&(b>0&&!F?(C.push([1,["Fixed satellite!"]]),F=1,b--):b>-1&&!F?C.push([1,["Need satellite chip"]]):F||C.push([1,["Satellite is offline"]]))),1===h[4]){if(26===h[3][o][t]&&C.pop(),21===h[3][o][t]){let e=[["Use",21]],t=[2,["A computer",""],e,0,"g"];!v[1]&&d>5&&e.push(["Fix Chips",23]),v[1]&&f>0&&e.push(["Restore Backups",41]),e.length>1?C.push(t):X[3]()}23===h[3][o][t]&&(I>=17||I<6?C.push(w[9]):C.push(w[10]))}},H,e=>{2===C[C.length-1][0]&&(C[C.length-1][3]=e)},()=>{if(2===C[C.length-1][0]){let e=C[C.length-1];if(!e[2].length)return void C.pop();let t=e[3],s=e[2][t][1];-1===s?H():4===w[s][0]?(C.pop(),X[w[s][1]]()):C.push(w[s])}}]})();document.onkeyup=(e=>{let t=P[0]()[7];if(3===t[0]&&(e=>{65!==e.keyCode&&37!==e.keyCode||P[4](-1,0),68!==e.keyCode&&39!==e.keyCode||P[4](1,0),87!==e.keyCode&&38!==e.keyCode||P[4](0,-1),83!==e.keyCode&&40!==e.keyCode||P[4](0,1)})(e),0!==t[0]&&1!==t[0]&&5!==t[0]||32!==e.keyCode&&27!==e.keyCode&&13!==e.keyCode||P[5](),2===t[0]){let s=t;27===e.keyCode&&P[5](),87!==e.keyCode&&38!==e.keyCode||s[3]>0&&P[6](s[3]-1),83!==e.keyCode&&40!==e.keyCode||s[3]<s[2].length-1&&P[6](s[3]+1),32!==e.keyCode&&13!==e.keyCode||P[7]()}});let H=([e,t])=>{let s=P[0]()[7],o=c.getBoundingClientRect().width/10,r=~~((e-c.getBoundingClientRect().left)/o)-1,h=~~((t-c.getBoundingClientRect().top)/o)-1;if(3===s[0]){if(4===r&&4===h)return;if(r<0||h<0)return;let e=n(r,4),t=n(h,4);let s=0,o=0;e>t?s=r>4?1:-1:e<t&&(o=h>4?1:-1),P[4](s,o)}if(0!==s[0]&&1!==s[0]&&5!==s[0]||P[5](),2===s[0]){let e=s,t=e[1].length%2?1:0,o=(e[1].length+t)/2,n=e[2].length,r=h-o+1;h<0&&P[5](),n||P[5](),r>=0&&r<n&&(r===e[3]?P[7]():P[6](r))}};c.ontouchend=(e=>{e.preventDefault();for(let t=0;t<e.changedTouches.length;t++)H([e.changedTouches[t].clientX,e.changedTouches[t].clientY])}),c.onclick=(e=>{e.preventDefault(),H([e.clientX,e.clientY])}),((...t)=>Promise.all(t.map(e)))("f.gif","t.gif","p.gif","s.png","c.gif").then(e=>{[G,L,$,b,D]=e,requestAnimationFrame(T)})};s();